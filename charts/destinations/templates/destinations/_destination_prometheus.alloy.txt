{{- define "destinations.prometheus.alloy" }}
prometheus.remote_write {{ include "helper.alloy_name" .name | quote }} {
  endpoint {
    url = {{ .url | quote }}
{{- if eq (include "destinations.auth.type" .) "basic" }}
    basic_auth {
      username = {{ include "destinations.secret.read" (dict "destination" . "key" "auth.username" "nonsensitive" true) }}
      password = {{ include "destinations.secret.read" (dict "destination" . "key" "auth.password") }}
    }
{{- else if eq (include "destinations.auth.type" .) "bearer_token" }}
    bearer_token = {{ include "destinations.secret.read" (dict "destination" . "key" "auth.bearer_token") }}
{{- end }}
  }
}
{{- end }}

{{- define "destinations.prometheus.secrets" -}}
- auth.username
- auth.password
- auth.bearer_token
{{- end -}}
